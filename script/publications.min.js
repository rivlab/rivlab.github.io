document.addEventListener("DOMContentLoaded", function () {
  let currentPage = 1;
  let totalPages = 2;

  const fetchData = async (page) => {
    try {
      const response = await fetch(`./data/publications/page${page}.json`);
      const jsonData = await response.json();
      return jsonData.publications;
    } catch (error) {
      console.error("Error fetching data:", error);
      return [];
    }
  };

  const displayData = (items) => {
    let publicationsResult = "";
    items.map((a, e) => {
      publicationsResult += `
    <div tabindex="2" data-id="${a.bibtex}" class="card_research">
    <div class="image_research_box">
    ${
      "" == a.image
        ? "<span></span>"
        : `<img alt="picture publication" data-src=${a.image} class="lazyload image_research" />
        `
    }
    </div>
    <div class="left_research_box">
      <span>
      <a aria-label="link title" href="${a.url}" target="_blank">
        <div class="title_research_box">
          <h4 class="title_research">
          ${a.title}
          </h4>
        </div>
      </a>
        <div class="contain_text_research_box">
          <p class="contain_text_research">
          ${a.abstract}
          </p>
        </div>
        <p class="jurnal">
        ${a.journal}, ${a.year}
        </p>
        <p class="author">
        ${a.author}
        </p>
      </span>
      <div class="icons_research_box">
        <div onclick="showModal('${
          a.bibtex
        }')" id="myBtn" class="icon_text_research">
        <a tabindex="1"   tabindex="5" class="show-modal">  <img alt="icon bibtex" src="./image/quote.png" class="icon" />
          <p class="paragraph_icon_research">BibTeX</p>
          </a> </div>
        ${
          a.pdf
            ? `<a aria-label="link pdf" href="${a.pdf}" target="_blank">
          <div class="icon_text_research">
            <img alt="icon pdf" src="./image/pdf.png" class="icon" />
            <p class="paragraph_icon_research">PDF</p>
          </div>
        </a>`
            : ""
        }
        ${
          a.code
            ? `<a aria-label="link code" href="${a.code}" target="_blank">
            <div class="icon_text_research">
              <img alt="icon code" src="./image/code.png" class="icon" />
              <p class="paragraph_icon_research">Code</p>
            </div>
          </a>`
            : ""
        }
        ${
          a.website
            ? `<a aria-label="link website" href="${a.website}" target="_blank">
            <div class="icon_text_research">
              <img alt="icon website" src="./image/world.png" class="icon" />
              <p class="paragraph_icon_research">Website</p>
            </div>
        </a>`
            : ""
        }
        ${
          a.youtube
            ? `<a aria-label="link youtube" href="${a.youtube}" target="_blank">
              <div class="icon_text_research">
                <img alt="icon youtube" src="./image/youtube.png" class="icon" />
                <p class="paragraph_icon_research">Youtube</p>
              </div>
          </a>`
            : ""
        }
      </div>
    </div>
  </div> 
  `;
    });
    let e = document.getElementById("publications_box_team");
    let button = document.getElementById("loadMoreButton");
    if (totalPages == currentPage) {
      button.remove();
    }
    e.innerHTML += publicationsResult;
  };

  const loadMore = async () => {
    if (currentPage < totalPages) {
      currentPage++;
      const nextPageData = await fetchData(currentPage);
      displayData(nextPageData);
    } else {
      console.log("No more pages to load.");
    }
  };

  const initPagination = async () => {
    const initialPageData = await fetchData(currentPage);
    displayData(initialPageData);
  };

  initPagination();

  document.getElementById("loadMoreButton").addEventListener("click", loadMore);
});
